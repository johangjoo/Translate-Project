import ollama
import os

# 사용할 Ollama 모델 이름
MODEL_NAME = 'mannix/llamax3-8b-alpaca:q8_0'

def translate_text(text, source_lang, target_lang):
    """
    주어진 텍스트를 지정된 언어로 번역합니다.

    :param text: 번역할 원본 텍스트
    :param source_lang: 원본 언어 (예: Korean)
    :param target_lang: 번역할 대상 언어 (예: English)
    :return: 번역된 텍스트
    """
    print(f"--- {source_lang} -> {target_lang} 번역 시작 ---")
    try:
        # 프롬프트 엔지니어링: LLM에게 명확한 역할과 지시를 내립니다.
        prompt = f"""
        You are a professional translator.
        Translate the following {source_lang} text to {target_lang}.
        Provide only the translated text, without any additional explanations or introductory phrases.

        Original Text:
        "{text}"

        Translated Text:
        """

        # Ollama 서버에 API 요청 보내기
        response = ollama.chat(
            model=MODEL_NAME,
            messages=[
                {'role': 'user', 'content': prompt},
            ],
            options={
                'temperature': 0.3 # 번역의 일관성을 위해 온도를 낮게 설정
            }
        )

        # 응답에서 번역된 텍스트만 추출
        translated_text = response['message']['content'].strip()
        print(f"번역 결과: {translated_text}")
        return translated_text

    except Exception as e:
        print(f"오류 발생: {e}")
        return None

def to_busan_satoori(text, source_lang="Korean"):
    """
    주어진 텍스트를 부산 사투리로 변환합니다. (새로 추가된 함수)
    페르소나, 명확한 지시, 퓨샷 프롬프팅 기법을 적용합니다.

    :param text: 변환할 원본 텍스트
    :param source_lang: 원본 언어 (기본값: Korean)
    :return: 부산 사투리로 변환된 텍스트
    """
    print(f"--- {source_lang} -> Korean (Busan Dialect) 변환 시작 ---")
    try:
        # 개선된 프롬프트
        prompt = f"""
        📌 강화된 부산 사투리 변환 프롬프트
        역할

        당신은 부산에서 태어나고 자란 20대 청년으로, 부산 사투리를 매우 유창하게 구사하는 사람입니다. 평소 친구, 동생, 선배와 대화할 때 쓰는 말투를 그대로 사용하세요.

        임무

        주어진 원본 문장을 당신의 평소 말투인 자연스럽고 현실적인 부산 사투리로 문장 단위 번역하세요.

        표준어 느낌이 전혀 나지 않게, 드라마 대사나 카카오톡 대화처럼 실제 생활에서 쓰는 사투리 톤을 내야 합니다.

        번역은 문장마다 대응되게 하되, 필요하면 부산식 뉘앙스에 맞게 단어를 추가·삭제해도 됩니다.

        핵심 규칙

        문장 단위 번역

        합치거나 줄이지 말고, 주어진 각 문장을 개별적으로 번역하세요.

        고유명사 유지

        영어, 외래어, 게임·유튜브·카드 등 고유명사는 그대로 둡니다.

        출력 형식

        오직 번역된 부산 사투리 텍스트만 출력하세요. (설명·주석·메타 발언 금지)

        자연스러운 어순

        부산 사람들이 실제 말할 때처럼 어순·강조를 조정하세요.

        감정·의도 반영

        화자가 농담하는지, 화내는지, 친근하게 부르는지 뉘앙스를 살려서 번역하세요.

        사투리 변환 지침
        1. 종결어미 변화

        평서문: ~야 → ~다 / ~다 아이가

        예: "맛있어" → "맛있다 아이가"

        의문문: ~니? ~어? → ~나? ~노?

        예: "뭐 하니?" → "뭐 하노?"

        명령문: ~해 → ~해라 / ~하이소 / ~해라카이

        예: "하지 마" → "하지 마라"

        제안: ~자 → ~카자

        예: "같이 가자" → "가자카자"

        추측·확신: ~일 거야 → ~일 끼다 / ~일 낀데이

        2. 조사 변화

        "누구야?" → "누고?"

        "뭐야?" → "뭐고?"

        "내가/내는" → "내가/내는" 그대로 두되 억양으로 구분

        3. 어휘 변화

        먹다 → 묵다

        왜 → 와

        정말 → 참말로

        재미있다 → 잼나다

        부끄럽다 → 쪽팔리다

        창피하다 → 쪽팔리다

        무섭다 → 겁나다

        배고프다 → 배고프다 아이가

        4. 강조·습관적 표현

        긍정 확인: 아이가

        미래 확신: 끼다

        친근 호응: 데이, 맞제?, 맞나?

        감탄: 와, 와이라노, 와 이래

        5. 말투 리듬

        짧게 끊어 말하기:

        "그거 니 거야?" → "그거 니꺼가?"

        강한 억양 살리기:

        "대단하다" → "대단하다 아이가!" 

        ### 참고 예시
        표준어: 뭐 하고 있니?
        부산 사투리: 뭐 하노?

        표준어: 밥 먹었니?
        부산 사투리: 밥 묵었나?

        표준어: 맛있어.
        부산 사투리: 맛있다 아이가.

        표준어: 하지 마.
        부산 사투리: 하지 마라.

        표준어: 같이 가자.
        부산 사투리: 가자카자.

        표준어: 누구야?
        부산 사투리: 누고?

        1~20: 기본 일상 대화

        표준어: 뭐 하고 있니?
        부산 사투리: 뭐 하노?

        표준어: 밥 먹었어?
        부산 사투리: 밥 묵었나?

        표준어: 어디 가니?
        부산 사투리: 어디 가노?

        표준어: 지금 뭐 해?
        부산 사투리: 지금 뭐 하노?

        표준어: 왜 그래?
        부산 사투리: 와 그라노?

        표준어: 진짜야?
        부산 사투리: 진짜가?

        표준어: 오늘 날씨 좋네.
        부산 사투리: 오늘 날씨 좋다 아이가.

        표준어: 하지 마.
        부산 사투리: 하지 마라.

        표준어: 같이 가자.
        부산 사투리: 가자카자.

        표준어: 알았어.
        부산 사투리: 알았다.

        표준어: 잘 지내니?
        부산 사투리: 잘 지내나?

        표준어: 이리 와.
        부산 사투리: 이리 온나.

        표준어: 뭐야 그게?
        부산 사투리: 그게 뭐고?

        표준어: 괜찮아.
        부산 사투리: 괜찮다.

        표준어: 고마워.
        부산 사투리: 고맙다.

        표준어: 빨리 와.
        부산 사투리: 빨리 온나.

        표준어: 잘했어.
        부산 사투리: 잘했다.

        표준어: 거기 있어.
        부산 사투리: 거기 있거라.

        표준어: 그만해.
        부산 사투리: 그만하이소.

        표준어: 피곤해.
        부산 사투리: 피곤하다.

        21~40: 질문과 감탄

        표준어: 언제 왔어?
        부산 사투리: 언제 왔노?

        표준어: 누구야?
        부산 사투리: 누고?

        표준어: 이거 얼마야?
        부산 사투리: 이거 몇 값이고?

        표준어: 무슨 일 있어?
        부산 사투리: 무슨 일 있노?

        표준어: 지금 어디 있니?
        부산 사투리: 지금 어디 있노?

        표준어: 어제 왜 안 왔어?
        부산 사투리: 어제 와 안 왔노?

        표준어: 정말 재밌다.
        부산 사투리: 진짜 잼나네.

        표준어: 너무 시끄럽다.
        부산 사투리: 징하게 시끄럽네.

        표준어: 그렇게 하면 안 돼.
        부산 사투리: 그라고 하면 안 된다 아이가.

        표준어: 다 괜찮을 거야.
        부산 사투리: 다 괜찮을 끼다.

        표준어: 이게 왜 이렇게 됐지?
        부산 사투리: 이게 와 이래 됐노?

        표준어: 배고파 죽겠어.
        부산 사투리: 배 고파 죽겠다 아이가.

        표준어: 뭐라고 했어?
        부산 사투리: 뭐라 했노?

        표준어: 진짜 놀랐어.
        부산 사투리: 와, 진짜 깜짝 놀랐다.

        표준어: 이거 네 거야?
        부산 사투리: 이거 니꺼가?

        표준어: 그 사람은 누구야?
        부산 사투리: 그 사람 누고?

        표준어: 어떻게 알았어?
        부산 사투리: 어케 알았노?

        표준어: 어디서 봤어?
        부산 사투리: 어디서 봤노?

        표준어: 지금 갈까?
        부산 사투리: 지금 갈끼가?

        표준어: 다 끝났어.
        부산 사투리: 다 끝났다 아이가.

        41~60: 설명과 서술

        표준어: 나는 오늘 집에만 있었어.
        부산 사투리: 나는 오늘 집에만 있었다 아이가.

        표준어: 아침부터 너무 바빴어.
        부산 사투리: 아침부터 징하게 바빴다.

        표준어: 친구랑 영화 봤어.
        부산 사투리: 친구랑 영화 봤다 아이가.

        표준어: 그 사람 참 친절하더라.
        부산 사투리: 그 사람 참말로 친절하대이.

        표준어: 여기 진짜 맛집이야.
        부산 사투리: 여 여기 진짜 맛집이다.

        표준어: 오늘 하루 너무 힘들었어.
        부산 사투리: 오늘 하루 징하게 힘들었다.

        표준어: 그때는 나도 몰랐어.
        부산 사투리: 그때는 나도 몰랐다 아이가.

        표준어: 어제는 비가 많이 왔어.
        부산 사투리: 어제는 비가 징하게 왔다.

        표준어: 네가 말한 게 맞아.
        부산 사투리: 니가 말한 게 맞다.

        표준어: 나는 그런 적 없어.
        부산 사투리: 나는 그런 적 없다 아이가.

        표준어: 이 집은 진짜 넓다.
        부산 사투리: 이 집 진짜 크다 아이가.

        표준어: 네 생각은 어때?
        부산 사투리: 니 생각은 어때노?

        표준어: 다 같이 가면 좋겠다.
        부산 사투리: 다 같이 가면 좋겠다 아이가.

        표준어: 나도 그거 하고 싶어.
        부산 사투리: 나도 그거 하고 싶다.

        표준어: 그렇게 하지 말라고 했잖아.
        부산 사투리: 그라고 하지 말라 했지 않나.

        표준어: 내가 잘못했어.
        부산 사투리: 내가 잘못했다 아이가.

        표준어: 늦게 와서 미안해.
        부산 사투리: 늦게 와서 미안하다.

        표준어: 오늘은 피곤해서 못 가겠어.
        부산 사투리: 오늘은 피곤해서 못 간다 아이가.

        표준어: 지금 생각해 보니 웃기네.
        부산 사투리: 지금 생각하이 보이 웃기다.

        표준어: 그거 진짜 대단하다.
        부산 사투리: 그거 진짜 대단하다 아이가.

        61~80: 감정 표현

        표준어: 너무 화가 났어.
        부산 사투리: 징하게 빡쳤다.

        표준어: 기분이 좋네.
        부산 사투리: 기분 좋다 아이가.

        표준어: 슬펐어.
        부산 사투리: 슬펐다 아이가.

        표준어: 걱정하지 마.
        부산 사투리: 걱정하지 마라.

        표준어: 기대돼.
        부산 사투리: 기대된다.

        표준어: 그건 너무 아쉽다.
        부산 사투리: 그건 징하게 아깝다.

        표준어: 진짜 속상했어.
        부산 사투리: 와, 진짜 속 상했다.

        표준어: 그때는 무서웠어.
        부산 사투리: 그때는 겁났다 아이가.

        표준어: 마음이 편안하다.
        부산 사투리: 마음이 편하다.

        표준어: 재밌게 놀았다.
        부산 사투리: 잼나게 놀았다 아이가.

        표준어: 부끄러웠어.
        부산 사투리: 쪽팔렸다.

        표준어: 너무 행복했어.
        부산 사투리: 징하게 행복했다.

        표준어: 그 말 듣고 놀랐어.
        부산 사투리: 그 말 듣고 깜짝 놀랐다 아이가.

        표준어: 지루했어.
        부산 사투리: 지루했다.

        표준어: 너무 창피했어.
        부산 사투리: 징하게 창피했다.

        표준어: 지금 설레.
        부산 사투리: 지금 두근거린다 아이가.

        표준어: 화내지 마.
        부산 사투리: 화 내지 마라.

        표준어: 너 덕분에 기분 좋아졌어.
        부산 사투리: 니 덕분에 기분 좋아졌다 아이가.

        표준어: 속이 후련하다.
        부산 사투리: 속이 시원하다.

        표준어: 진짜 멋있었어.
        부산 사투리: 진짜 간지났다 아이가.

        81~100: 긴 문장, 상황 묘사

        표준어: 오늘 하루 종일 일만 해서 너무 피곤해.
        부산 사투리: 오늘 하루 종일 일만 해가 징하게 피곤하다.

        표준어: 어제는 늦게까지 공부하느라 잠을 못 잤어.
        부산 사투리: 어제는 늦게까지 공부하이 잠을 못 잤다 아이가.

        표준어: 네가 말해 준 대로 했는데 잘 안 됐어.
        부산 사투리: 니가 말한 대로 했는데 잘 안 됐다.

        표준어: 친구들이랑 모여서 놀았는데 진짜 재밌었어.
        부산 사투리: 친구들이랑 모여가 노는데 진짜 잼났다 아이가.

        표준어: 버스를 놓쳐서 학교에 늦었어.
        부산 사투리: 버스 놓쳐가 학교 늦었다.

        표준어: 이 길로 가면 더 빨리 갈 수 있어.
        부산 사투리: 이 길로 가면 더 빨리 갈 수 있다 아이가.

        표준어: 그 사람은 나한테 큰 도움이 됐어.
        부산 사투리: 그 사람은 내한테 큰 도움 됐다.

        표준어: 어제 본 영화가 너무 감동적이었어.
        부산 사투리: 어제 본 영화가 징하게 감동적이었다 아이가.

        표준어: 오늘 회의가 길어져서 점심도 못 먹었어.
        부산 사투리: 오늘 회의가 길어져가 점심도 못 묵었다.

        표준어: 길이 막혀서 약속에 늦을 것 같아.
        부산 사투리: 길이 막혀가 약속 늦을 낀데이.

        표준어: 네가 없었으면 힘들었을 거야.
        부산 사투리: 니 없었으면 힘들었을 끼다.

        표준어: 내일 비 온다니까 우산 챙겨.
        부산 사투리: 내일 비 온다 카니까 우산 챙기라.

        표준어: 할머니가 해 주신 밥이 제일 맛있어.
        부산 사투리: 할매가 해준 밥이 제일 맛있다 아이가.

        표준어: 혼자 있기 싫어서 나왔어.
        부산 사투리: 혼자 있기 싫어가 나왔다.

        표준어: 그렇게 하면 다칠 수도 있어.
        부산 사투리: 그라고 하면 다칠 수도 있다 아이가.

        표준어: 생각보다 일이 잘 풀려서 기뻤어.
        부산 사투리: 생각보다 일이 잘 풀려가 기뻤다.

        표준어: 네가 해 준 말이 큰 힘이 됐어.
        부산 사투리: 니가 해준 말이 큰 힘 됐다 아이가.

        표준어: 나는 항상 네 편이야.
        부산 사투리: 나는 맨날 니 편이다.

        표준어: 시험이 어려웠는데 다행히 잘 봤어.
        부산 사투리: 시험이 빡셌는데 다행히 잘 봤다 아이가.

        표준어: 우리 같이 열심히 해서 끝내자.
        부산 사투리: 우리 같이 열심히 해가 끝내자카자.

        ---

        ### 최종 지시
        이제 아래의 '원본 텍스트'를 부산 사투리로 번역하세요.

        원본 텍스트: "{text}"
        부산 사투리 번역:
        """

        response = ollama.chat(
            model=MODEL_NAME,
            messages=[{'role': 'user', 'content': prompt}],
            options={'temperature': 0.5} # 사투리 변환은 약간의 창의성을 위해 온도를 조금 높임
        )
        translated_text = response['message']['content'].strip()
        print(f"변환 결과: {translated_text}")
        return translated_text

    except Exception as e:
        print(f"오류 발생: {e}")
        return None

def read_file(file_path):
    """파일을 읽어 내용을 반환합니다."""
    if not os.path.exists(file_path):
        print(f"'{file_path}'을 찾을 수 없습니다. 파일을 생성하고 내용을 입력해주세요.")
        return None
    with open(file_path, 'r', encoding='utf-8') as f:
        return f.read()

if __name__ == "__main__":
    # --- 1. 한국어 -> 부산 사투리 테스트 ---
    print("="*25 + " 한국어 -> 부산 사투리 테스트 " + "="*25)
    korean_file = "test.txt"
    original_korean_text = read_file(korean_file)
    if original_korean_text:
        print(f"원본 텍스트 (Korean):\n{original_korean_text}\n")
        to_busan_satoori(original_korean_text, source_lang="Korean")

    print("\n" + "="*70 + "\n")

    # --- 2. 일본어 -> 한국어(표준어) -> 부산 사투리 테스트 ---
    print("="*20 + " 일본어 -> 한국어 -> 부산 사투리 테스트 " + "="*20)
    japanese_file = "test_jp.txt"
    original_japanese_text = read_file(japanese_file)
    if original_japanese_text:
        print(f"원본 텍스트 (Japanese):\n{original_japanese_text}\n")
        
        # 1단계: 일본어 -> 한국어 번역
        translated_korean_text = translate_text(original_japanese_text, "Japanese", "Korean")
        
        print("-" * 70)

        # 2단계: 번역된 한국어 -> 부산 사투리 변환
        if translated_korean_text:
            to_busan_satoori(translated_korean_text, source_lang="Korean (from Japanese)")
