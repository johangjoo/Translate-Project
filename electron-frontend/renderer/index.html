<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brewer Translation - 음성 번역 도구</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- 헤더 -->
        <header class="app-header">
            <div class="header-content">
                <div class="logo">
                    <img src="../Brewer_icon.png" alt="Logo" class="logo-image">
                    <h1>Brewer Translation</h1>
                </div>
            </div>
        </header>

        <!-- 메인 컨텐츠 -->
        <main class="main-content">

            <!-- 파일 선택 패널 -->
            <div class="panel file-panel">
                <h2><i class="fas fa-file-audio"></i> 파일 선택</h2>
                <div class="file-input-area">
                    <div class="file-drop-zone" id="fileDropZone">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>오디오/비디오 파일을 드래그하거나 클릭하여 선택하세요</p>
                        <p class="file-types">지원 형식: MP3, WAV, MP4, AVI, MOV, MKV 등</p>
                        <button id="selectFileBtn" class="btn btn-primary">
                            <i class="fas fa-folder-open"></i> 파일 선택
                        </button>
                    </div>
                    <div class="selected-file" id="selectedFile" style="display: none;">
                        <div class="file-info">
                            <i class="fas fa-file"></i>
                            <div class="file-details">
                                <span class="file-name" id="fileName"></span>
                                <span class="file-path" id="filePath"></span>
                            </div>
                            <button id="removeFileBtn" class="btn btn-danger btn-small">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>

            </div>

            <!-- 변환 및 처리 패널 -->
            <div class="panel processing-panel">
                <h2><i class="fas fa-cogs"></i> 처리 옵션</h2>
                
                <!-- 처리 옵션 그리드 -->
                <div class="options-grid">
                    <!-- 처리 옵션 열 -->
                    <div class="option-column">
                        <h3>처리 옵션</h3>
                        <div class="column-buttons">
                            <button type="button" class="round-square-btn processing-btn active" data-mode="transcribe" id="sttOnlyBtn">
                                <i class="fas fa-microphone"></i>
                                <span>음성인식만</span>
                            </button>
                            <button type="button" class="round-square-btn processing-btn" data-mode="audio-to-translation" id="fullPipelineBtn">
                                <i class="fas fa-language"></i>
                                <span>음성인식+번역</span>
                            </button>
                        </div>
                    </div>

                    <!-- 고급 옵션 열 -->
                    <div class="option-column">
                        <h3>고급 옵션</h3>
                        <div class="column-buttons">
                            <button type="button" class="round-square-btn option-btn active" data-option="speaker-diarization" id="speakerDiarizationBtn">
                                <i class="fas fa-users"></i>
                                <span>화자분리</span>
                            </button>
                            <button type="button" class="round-square-btn option-btn active" data-option="timestamps" id="timestampsBtn">
                                <i class="fas fa-clock"></i>
                                <span>타임스탬프</span>
                            </button>
                        </div>
                    </div>

                    <!-- 최대 화자수 열 -->
                    <div class="option-column">
                        <h3>최대화자수</h3>
                        <div class="column-buttons">
                            <div class="speaker-count-display">
                                <span class="count-number" id="speakerCountDisplay">2명</span>
                            </div>
                            <select id="maxSpeakers" class="speaker-select">
                                <option value="1">1명</option>
                                <option value="2" selected>2명</option>
                                <option value="3">3명</option>
                                <option value="4">4명</option>
                                <option value="5">5명</option>
                                <option value="6">6명</option>
                                <option value="7">7명</option>
                                <option value="8">8명</option>
                                <option value="9">9명</option>
                                <option value="10">10명</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- STT 언어 설정 (음성인식만 모드일 때만 표시) -->
                <div class="stt-language-settings" id="sttLanguageSettings" style="display: none;">
                    <div class="input-row">
                        <div class="input-group">
                            <label for="sttLanguage">인식 언어:</label>
                            <select id="sttLanguage">
                                <option value="">자동 감지</option>
                                <option value="ko" selected>한국어</option>
                                <option value="ja">일본어</option>
                                <option value="en">영어</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <small class="input-help">
                                언어를 선택하면 더 정확한 인식이 가능합니다. 자동 감지도 가능합니다.
                            </small>
                        </div>
                    </div>
                </div>

                <!-- 번역 설정 (풀 파이프라인 모드일 때만 표시) -->
                <div class="translation-settings" id="translationSettings" style="display: none;">
                    <!-- 언어 설정 -->
                    <div class="input-row">
                        <div class="input-group">
                            <label for="sourceLang">원본 언어:</label>
                            <select id="sourceLang">
                                <option value="ko" selected>한국어</option>
                                <option value="ja">일본어</option>
                                <option value="en">영어</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="targetLang">번역 언어:</label>
                            <select id="targetLang">
                                <option value="ko" selected>한국어</option>
                                <option value="ja">일본어</option>
                                <option value="en">영어</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- 번역 모델 선택 -->
                    <div class="input-row">
                        <div class="input-group">
                            <label for="translationModel">번역 모델:</label>
                            <select id="translationModel">
                                <optgroup label="Qwen 로컬 모델 (무료)">
                                    <option value="qwen-14b-lora" selected>Qwen3-14B LoRA (기본)</option>
                                    <option value="qwen-8b-base">Qwen3-8B Base</option>
                                    <option value="qwen-8b-lora">Qwen3-8B LoRA (10ratio)</option>
                                    <option value="qwen-14b-base">Qwen3-14B Base</option>
                                </optgroup>
                                <optgroup label="API 모델 (유료)">
                                    <option value="openai">OpenAI GPT-5.1</option>
                                    <option value="gemini">Google Gemini 2.5 flash</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="input-group">
                            <small class="model-description" id="modelDescription">
                                Qwen3는 무료 모델이지만 번역 성능이 보통입니다, API키는 필요하지 않습니다.
                            </small>
                        </div>
                    </div>
                    
                    <!-- API 키 입력 (OpenAI/Gemini 선택 시에만 표시) -->
                    <div class="input-row" id="apiKeyRow" style="display: none;">
                        <div class="input-group full-width">
                            <label for="apiKey">🔑 API 키:</label>
                            <input type="password" id="apiKey" placeholder="API 키를 입력하세요..." />
                            <small class="input-help" id="apiKeyHelp">
                                OpenAI: sk-... 형태 / Gemini: AIza... 형태
                            </small>
                        </div>
                    </div>
                </div>

                <!-- 처리 시작 버튼 -->
                <div class="action-buttons">
                    <button id="processBtn" class="btn btn-success btn-large" disabled>
                        <i class="fas fa-play"></i>
                        <span>처리 시작</span>
                    </button>
                </div>
            </div>

            <!-- 진행률 패널 -->
            <div class="panel progress-panel" id="progressPanel">
                <h2><i class="fas fa-tasks"></i> 처리 진행률</h2>
                
                <!-- 변환 진행률 (숨김처리) -->
                <div class="progress-section" style="display: none;">
                    <div class="progress-header">
                        <span class="progress-title">1. 오디오 변환 (WAV)</span>
                        <span class="progress-status" id="conversionStatus">대기 중</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="conversionProgress"></div>
                    </div>
                    <div class="progress-details" id="conversionDetails"></div>
                </div>

                <!-- 업로드 진행률 (숨김처리) -->
                <div class="progress-section" style="display: none;">
                    <div class="progress-header">
                        <span class="progress-title">2. 서버 업로드</span>
                        <span class="progress-status" id="uploadStatus">대기 중</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="uploadProgress"></div>
                    </div>
                </div>

                <!-- 처리 진행률 -->
                <div class="progress-section">
                    <div class="progress-header">
                        <span class="progress-title">AI 처리</span>
                        <span class="progress-status" id="processingStatus">대기 중</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="aiProgress"></div>
                    </div>
                </div>
            </div>

            <!-- 결과 패널 -->
            <div class="panel results-panel" id="resultsPanel">
                <h2><i class="fas fa-clipboard-list"></i> 처리 결과</h2>
                
                <!-- 결과 컨테이너 (좌우 배치) -->
                <div class="results-container">
                    <!-- STT 결과 -->
                    <div class="result-section left-result">
                        <div class="result-header">
                            <h3><i class="fas fa-microphone"></i> 음성 인식 결과</h3>
                            <div class="result-meta">
                                <span class="detected-lang" id="detectedLang"></span>
                                <span class="processing-time" id="sttTime"></span>
                            </div>
                        </div>
                        <div class="result-content">
                            <textarea id="sttResult" placeholder="음성 인식 결과가 여기에 표시됩니다... (드래그하여 붙여넣기 가능)"></textarea>
                            <button class="copy-btn" onclick="copyToClipboard('sttResult')">
                                <i class="fas fa-copy"></i> 복사
                            </button>
                        </div>
                    </div>

                    <!-- 번역 결과 -->
                    <div class="result-section right-result" id="translationResult">
                        <div class="result-header">
                            <h3><i class="fas fa-language"></i> 번역 결과</h3>
                            <div class="result-meta">
                                <span class="translation-info" id="translationInfo"></span>
                                <span class="processing-time" id="translationTime"></span>
                            </div>
                        </div>
                        <div class="result-content">
                            <textarea id="translatedResult" placeholder="번역 결과가 여기에 표시됩니다... (드래그하여 붙여넣기 가능)"></textarea>
                            <button class="copy-btn" onclick="copyToClipboard('translatedResult')">
                                <i class="fas fa-copy"></i> 복사
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 액션 버튼들 -->
                <div class="result-actions">
                    <button id="newProcessBtn" class="btn btn-danger">
                        <i class="fas fa-redo"></i> 초기화
                    </button>
                    <button id="saveTxtBtn" class="btn btn-secondary">
                        <i class="fas fa-save"></i> txt로 저장
                    </button>
                    <button id="saveSrtBtn" class="btn btn-secondary">
                        <i class="fas fa-save"></i> srt로 저장
                    </button>
                </div>
            </div>
        </main>

        <!-- 푸터 -->
        <footer class="app-footer">
            <div class="footer-content">
                <span>Brewer Translation v1.0.0 - Powered by Whisper & LLM</span>
                <div class="footer-links">
                    <a href="#" onclick="showAbout()">정보</a>
                    <a href="#" onclick="showHelp()">도움말</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- 로딩 오버레이 -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-content">
            <div class="spinner"></div>
            <p id="loadingText">처리 중...</p>
        </div>
    </div>

    <!-- 토스트 알림 -->
    <div class="toast" id="toast"></div>

    <script src="script.js"></script>
</body>
</html>